{% extends "base/index.html" %}
{% block title %}Supermarket Metodyczny{% endblock %}
{% load staticfiles %}
{% block content %}
    <div class="page-header">
        <h1>AKCEPTOWANIE PROPOZYCJI</h1>
    </div>
    <form action="#" method="POST">
        {% csrf_token %}
        <div class="proposal">
            {% if zle|length > 0 %}
            <p class="proposal_error">Próbujesz zaakceptować propozycję które są przypisane do niezakceptowanych narzędzii!</p>
            {% endif %}
            <table class="proposal_table">
                <caption>Narzędzia</caption>
                <col width="10%">
                <col width="10%">
                <col width="10%">
                <col width="60%">
                <col width="10%">
                <thead>
                    <tr>
                        <th>Nazwa</th>
                        <th>Dodana Przez</th>
                        <th>Autor</th>
                        <th>Opis</th>
                        <th>Zaakceptuj</th>
                    </tr>
                </thead>
                {% if narzedzie|length  > 0 %}
                <tfoot>
                    <tr>
                        <td colspan="5"></td>
                        <td>Wszystkie</td>
                        <td>
                            <div class="checkboxThree all_check_box ">
                                <input type="checkbox" id="all_narzedzia" >
                                <label for="all_narzedzia"></label>
                            </div>
                        </td>
                    </tr>
                </tfoot>
                {% endif %}
                <tbody>
                {% for prop in narzedzie %}
                    <tr>
                        <td>{{prop.nazwa}}</td>
                        <td>{{prop.dodana_przez}}</td>
                        <td>{{prop.autor}}</td>
                        <td class="desc">{{prop.opis}}</td>
                        <td>
                             <div class="checkboxThree">
                                <input type="checkbox" name="accept_narzedzia" value="{{prop.pk}}" id="accept_{{prop.pk}}">
                                <label for="accept_{{prop.pk}}"></label>
                            </div>
                        </td>
                    </tr>
                {% empty %}
                    <tr>
                        <td colspan="7"> Brak niezaakceptowanych narzędzi... </td>
                    </tr>
                {% endfor %}
                </tbody>
            </table>
            <table class="proposal_table">
                <caption>Pomysły</caption>
                <col width="10%">
                <col width="10%">
                <col width="10%">
                <col width="10%">
                <col width="40%">
                <col width="10%">
                <col width="10%">
                {% if pomysl|length  > 0 %}
                <tfoot>
                    <tr>
                        <td colspan="5"></td>
                        <td>Wszystkie</td>
                        <td>
                            <div class="checkboxThree all_check_box ">
                                <input type="checkbox" id="all_pomysly" >
                                <label for="all_pomysly"></label>
                            </div>
                        </td>
                    </tr>
                </tfoot>
                {% endif %}
                <thead>
                    <tr>
                        <th>Nazwa</th>
                        <th>Drużyna</th>
                        <th>Dodana Przez</th>
                        <th>Autor</th>
                        <th>Opis</th>
                        <th>Narzedzie</th>
                        <th>Zaakceptuj</th>
                    </tr>
                </thead>
                <tbody>
                {% for prop in pomysl %}
                    <tr {% if prop.pk in zle %}class="proposal_error_tr"{% endif %}>
                        <td>{{prop.nazwa}}</td>
                        <td>{{prop.druzyna}}</td>
                        <td>{{prop.dodana_przez}}</td>
                        <td>{{prop.autor}}</td>
                        <td class="desc">{{prop.opis}}</td>
                        <td>{{prop.narzedzie}}{% if not prop.narzedzie.zaakceptowany %}*{% endif%}</td>
                        <td>
                             <div class="checkboxThree">
                                <input type="checkbox" name="accept" value="{{prop.pk}}" id="accept_{{prop.pk}}">
                                <label for="accept_{{prop.pk}}"></label>
                            </div>
                        </td>
                    </tr>
                {% empty %}
                    <tr>
                        <td colspan="7"> Brak niezaakceptowanych pomysłów... </td>
                    </tr>
                {% endfor %}
                </tbody>
            </table>

            <table class="proposal_table">
                <caption>Błędy</caption>
                <col width="10%">
                <col width="10%">
                <col width="10%">
                <col width="10%">
                <col width="40%">
                <col width="10%">
                <col width="10%">
                {% if blad|length  > 0 %}
                 <tfoot>
                    <tr>
                        <td colspan="5"></td>
                        <td>Wszystkie</td>
                        <td>
                            <div class="checkboxThree all_check_box ">
                                <input type="checkbox" id="all_bledy" >
                                <label for="all_bledy"></label>
                            </div>
                        </td>
                    </tr>
                </tfoot>
                {% endif %}
                <thead>
                    <tr>
                        <th>Nazwa</th>
                        <th>Drużyna</th>
                        <th>Dodana Przez</th>
                        <th>Autor</th>
                        <th>Opis</th>
                        <th>Narzedzie</th>
                        <th>Zaakceptuj</th>
                    </tr>
                </thead>
                <tbody>
                {% for prop in blad %}
                    <tr {% if prop.pk in zle %}class="proposal_error_tr"{% endif %}>
                        <td>{{prop.nazwa}}</td>
                        <td>{{prop.druzyna}}</td>
                        <td>{{prop.dodana_przez}}</td>
                        <td>{{prop.autor}}</td>
                        <td class="desc">{{prop.opis}}</td>
                        <td>{{prop.narzedzie}}{% if not prop.narzedzie.zaakceptowany %}*{% endif%}</td>
                        <td>
                             <div class="checkboxThree">
                                <input type="checkbox" name="accept" value="{{prop.pk}}" id="accept_{{prop.pk}}">
                                <label for="accept_{{prop.pk}}"></label>
                            </div>
                        </td>
                    </tr>
                {% empty %}
                    <tr>
                        <td colspan="7"> Brak niezaakceptowanych błędów... </td>
                    </tr>
                {% endfor %}
                </tbody>
            </table>
            <table class="proposal_table">
                <caption>Tradycje</caption>
                <col width="10%">
                <col width="10%">
                <col width="10%">
                <col width="10%">
                <col width="40%">
                <col width="10%">
                <col width="10%">
                {% if tradycja|length  > 0 %}
                <tfoot>
                    <tr>
                        <td colspan="5"></td>
                        <td>Wszystkie</td>
                        <td>
                            <div class="checkboxThree all_check_box">
                                <input type="checkbox" id="all_tradycje" >
                                <label for="all_tradycje"></label>
                            </div>
                        </td>
                    </tr>
                </tfoot>
                {% endif %}
                <thead>
                    <tr>
                        <th>Nazwa</th>
                        <th>Drużyna</th>
                        <th>Dodana Przez</th>
                        <th>Autor</th>
                        <th>Opis</th>
                        <th>Narzedzie</th>
                        <th>Zaakceptuj</th>
                    </tr>
                </thead>
                <tbody>
                {% for prop in tradycja %}
                    <tr {% if prop.pk in zle %}class="proposal_error_tr"{% endif %}>
                        <td>{{prop.nazwa}}</td>
                        <td>{{prop.druzyna}}</td>
                        <td>{{prop.dodana_przez}}</td>
                        <td>{{prop.autor}}</td>
                        <td class="desc">{{prop.opis}}</td>
                        <td>{{prop.narzedzie}}</td>
                        <td>
                             <div class="checkboxThree">
                                <input type="checkbox" name="accept" value="{{prop.pk}}" id="accept_{{prop.pk}}">
                                <label for="accept_{{prop.pk}}"></label>
                            </div>
                        </td>
                    </tr>
                {% empty %}
                    <tr>
                        <td colspan="7"> Brak niezaakceptowanych tradycji... </td>
                    </tr>
                {% endfor %}
                </tbody>
            </table>
            <div class="proposal_submit">
             {% if proposal|length  > 0 %}
                <input type="submit" value="Zaakceptuj wybrane">
            {% endif %}
            </div>
        </div>
    </form>
{% endblock %}
{% block scripts %}
<script>
$('.all_check_box input[type=checkbox]').change(function() {
    console.log('tapczan');
    $(this).closest('table').find('tbody').find('input[type=checkbox]').prop('checked',$(this).prop('checked'));
});
$('input[type=checkbox]').not('.all_check_box input[type=checkbox]').change(function() {
    console.log('kapcie');
    if($(this).closest('tbody').find('input[type=checkbox]').not(':checked').length > 0){
        $(this).closest('table').find('.all_check_box input[type=checkbox]').prop('checked',false);
    }else{
        $(this).closest('table').find('.all_check_box input[type=checkbox]').prop('checked',true);
    }
});
</script>
{% endblock %}
