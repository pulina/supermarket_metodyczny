{% extends "base/index.html" %}
{% block title %}Supermarket Metodyczny{% endblock %}
{% block content %}
{% load static%}
    <div class="page-header">
        <h1>DROGA HARCERZA</h1>
    </div>
    <br>
	<p class="lead">Wybierz wiek:</p>
    <br>
<!--
	<div style="text-align: center;"></div>
	<p id="wartosc"></p>
-->
	<!--<input id='suwak' style="width:100%" type="range" value='0' min='0' max='{{max}}' onchange="setLabelPosition(this.value)">--->
    <div style="width:1140px; height:0px;border: 3px solid black;-webkit-border-radius: 3px;-moz-border-radius: 3px;border-radius: 3px; "></div>
    <div id="elem" style="width:1000px; height:100px;margin-left:auto;margin-right: auto;">

    </div>
    <br>
    <div id="slider_thumb"></div>
    <div class="row marketing">
        <div class="col-lg-6 ramki">
		<p class="lead" id='nazwa'></p>
		<p class="lead"> <span id='stopien'></span></p>
		<p class="lead" id='opis'></p>
		<p class="lead">Możliwe funkcję:</p>
		<ul id='funkcje'>
		</ul>
        </div>

        <div class="col-lg-6 ramki">
		<p class="lead">Dostępne formy:</p>
		<p style='margin: 10px' id='formy'></p>
        </div>
      </div>
{% endblock %}
{% block scripts %}
<style>
.year{
  width: 100px;
  float: left;
  margin: 5px;
  text-align:center
}
.month{
  width: 73px;
  float: left;
  margin: 5px;
  text-align:center
}

.month::before,
.year::before{
  background-position:center top;
  display: block;
  background-repeat:no-repeat;
  background-image: url('{% static "img/dot.gif" %}');
  background-size: 10px 10px;
  content:"";
  position:relative;
  z-index:100;
  top:-15px;
  width: 100%;
  height: 20px;
}

#slider_thumb{
  position:absolute;
  background-repeat:no-repeat;
  background-image: url('http://staff.washington.edu/tabrooks/343INFO/YUIverticalSlider/thumb-bar.gif');
  background-size:  26px;
  z-index: 200;
  width: 50px;
  height: 30px;
}


</style>
<script type="text/javascript">
    var zoom_stage=0;
    var ZOOM_STAGE_YEARS = 0;
    var ZOOM_STAGE_MONTHS = 1;

    var etapy = [];
		{% for obj in okresy %}
		    etapy.push({
		            pk : {{obj.pk}},
		            repr : "{{obj.nazwa}}<br>{{obj.rok}}",
                nazwa: "{{ obj.nazwa|escapejs }}",
                opis:"{{ obj.opis|linebreaks|escapejs }}",
                rok:"{{obj.rok}}"
            });
		{% endfor %}

		var lata = [];
		{% for obj in lata %}
		    lata.push("{{ obj.nazwa|escapejs }}");
		{% endfor %}

    //display
    function show_years(){
        $('#elem').empty();
        $('#slider_thumb').hide()
        setSliderThumb($('.year').first())
        for (i = 0; i < lata.length; i++) {
            var new_elem = $( '<div/>', {
              id: lata[i],
              html: lata[i]
          });
          new_elem.addClass('year')
          $('#elem').append(new_elem);
        }
        $('.year').click(function(e) {
          if(zoom_stage == ZOOM_STAGE_YEARS){
            ++zoom_stage;
            show_months($(this));
          }
        });
    }



    function setSliderThumb(month){
        var slider = $('#slider_thumb');
        var bottomTop = month.prop('offsetTop');
        var bottomLeft = month.prop('offsetLeft');
        slider.css('top', bottomTop-16);
        slider.css('left', bottomLeft+22);
    }

    function show_months(year){
        $('#elem').empty();
        $('#slider_thumb').show()
        for (i = 0; i < etapy.length; i++) {
        console.log(etapy[i].rok)
        console.log(year)
          if(etapy[i].rok == year.prop('id')){
            var new_elem = $( '<div/>', {
            id: etapy[i].pk,
            html: etapy[i].repr
          });
          new_elem.addClass('month')
          $('#elem').append(new_elem);
        }
      }
      $('.month').click(function(e) {
        setSliderThumb($(this))
        setLabelPosition($(this).prop('id'))
      });
      setSliderThumb($('.month').first())
    }


    $(document).ready(function() {
      var $dragging = null;

      $(document.body).on("mousemove", function(e) {
          if ($dragging) {
              top = $dragging.prop('offsetTop');
              left = e.pageX;
              if(left < $('#main').prop('offsetLeft')+80){
                left = $('#main').prop('offsetLeft')+80
              }
              if(left >= $('#main').prop('offsetLeft')+1060){
                left = $('#main').prop('offsetLeft')+1060
              }
              $dragging.offset({
                  top: top,
                  left: left
              });
              e.preventDefault();
          }
      });

      $(document.body).on("mousedown", "#slider_thumb", function (e) {
              $dragging = $(e.target);

      });

      $(document.body).on("mouseup", function (e) {


          $('.month').each(function( index ) {
          try{
              if((($(this).prop('offsetLeft')-5) < $dragging.prop('offsetLeft')) && ($dragging.prop('offsetLeft') < ($(this).prop('offsetLeft')+78) )){
                  $(this).click();
              }
            }catch(err){;}
          });
          $dragging = null;
      });
    });
    //init
    show_years();
    //zooming
     //FF
     $('#elem').bind('DOMMouseScroll', function(e){
         if(e.originalEvent.detail > 0) {
              if(zoom_stage == ZOOM_STAGE_MONTHS){
                --zoom_stage;
                 show_years();
              }
         }else {
              e.target.click()
         }
         return false;
     });
     //IE, Opera, Safari
     $('#elem').bind('mousewheel', function(e){
         if(e.originalEvent.wheelDelta < 0) {
               if(zoom_stage == ZOOM_STAGE_MONTHS){
                --zoom_stage;
                 show_years();
              }
         }else {
           if(e.target.class = 'year'){
            e.target.click()
           }
         }
         return false;
     });
    	function setLabelPosition(newValue) {
    	      document.getElementById("opis").innerHTML=etapy[newValue].opis;
            document.getElementById("wiek").innerHTML=etapy[newValue].wiek;
            document.getElementById("stopien").innerHTML=etapy[newValue].stopien;

            document.getElementById("nazwa").innerHTML=etapy[newValue].nazwa;
            document.getElementById("funkcje").innerHTML= '';
            if(etapy[newValue].funkcja.length>=0){
                for (var x in etapy[newValue].funkcja){
                    document.getElementById("funkcje").innerHTML+='<li>'+etapy[newValue].funkcja[x]+'</li>';
                }
            }else{
                document.getElementById("funkcje").innerHTML='<li>Brak powiązanych funkcji</li>';
            }
            $('#formy').load(Urls.supermarket_formy(etapy[newValue].pk));
    	}
    </script>
	{% endblock %}
